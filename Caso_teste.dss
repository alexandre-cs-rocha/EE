clear

new circuit.6Bus basekV=11 phases=3 pu = 1.0677 basemva=33.3
! **** HAVE TO STIFFEN THE SOURCE UP A LITTLE; THE TEST CASE ASSUMES AN INFINITE BUS
 ~ puZ0 = [0, 0.150] puZ1 = [0, 0.010] puZ2 = [0, 0.09]
! ~ mvasc3 = 2000000 mvasc1 = 2000000

! LINES
!new line.fake length=1 units=m bus1=sourcebus bus2=n6
! ~ rmatrix = [2.52133983e-17 -8.49641139e-02  8.49641139e-02 | 8.49641139e-02 -3.78200974e-17 -8.49641139e-02 | -8.49641139e-02  8.49641139e-02 -7.56401948e-17]
! ~ xmatrix = [0.30401401 0.12051552 0.12051552 | 0.12051552 0.30401401 0.12051552 | 0.12051552 0.12051552 0.30401401]

new line.line1 length=1 units=m bus1=n1 bus2=n2
 ~ rmatrix = [3.3429429429429436 1.7441441441441443 1.598798798798799 | 1.7441441441441443 3.0522522522522526 1.4534534534534538 | 1.598798798798799 1.4534534534534538 3.4882882882882886 ]
 ~ xmatrix = [21.36576576576577 11.62762762762763 10.174174174174176 | 11.62762762762763 21.801801801801805 11.62762762762763 | 10.174174174174176 11.62762762762763 21.511111111111116 ]
 ~ cmatrix = [ 82.12592363 -14.6001642  -16.42518473 | -14.6001642   73.000821 -20.07522578 | -16.42518473 -20.07522578  63.87571838]

new line.line2 length=1 units=m bus1=n1 bus2=n3
 ~ rmatrix = [4.360360360360361 5.813813813813815 2.9069069069069076 | 3.633633633633634 6.104504504504505 5.813813813813815 | 2.9069069069069076 5.813813813813815 6.104504504504505 ]
 ~ xmatrix = [36.336336336336345 36.336336336336345 36.336336336336345 | 31.975975975975977 40.696696696696705 40.696696696696705 | 36.336336336336345 40.696696696696705 40.696696696696705 ]
 ~ cmatrix = [ 73.000821 -54.75061575 -63.87571838 | -82.12592363  63.87571838 -58.4006568 | -73.000821   -58.4006568   51.1005747 ]

new line.line3 length=1 units=m bus1=n2 bus2=n3
 ~ rmatrix = [4.360360360360361 3.0522522522522526 2.9069069069069076 | 3.0522522522522526 4.505705705705706 2.9069069069069076 | 2.9069069069069076 2.9069069069069076 4.796396396396397]
 ~ xmatrix = [37.06306306306307 17.441441441441444 14.534534534534536 | 17.441441441441444 36.77237237237238 17.441441441441444 | 14.534534534534536 17.441441441441444 36.336336336336345]
 ~ cmatrix = [ 78.47588258 -73.000821 -58.4006568 | -58.4006568   69.35077995 -51.1005747 | -51.1005747  -58.4006568   45.62551313]

new line.line4 length=1 units=m bus1=n3 bus2=n4
 ~ rmatrix = [3.633633633633634 1.8894894894894896 1.7441441441441443 | 1.8894894894894896 3.197597597597598 1.4534534534534538 | 1.7441441441441443 1.4534534534534538 3.778978978978979 ]
 ~ xmatrix = [19.912312312312316 13.081081081081082 10.174174174174176 | 13.081081081081082 21.801801801801805 13.081081081081082 | 10.174174174174176 13.081081081081082 21.220420420420425 ]
 ~ cmatrix = [ 63.87571838 -23.72526683 -25.55028735 | -23.72526683  64.24072248 -23.72526683 | -25.55028735 -23.72526683  62.05069785]

new line.line5 length=1 units=m bus1=n4 bus2=n5
 ~ rmatrix = [7.267267267267268 3.197597597597598 2.470870870870871 | 3.197597597597598 7.703303303303304 3.197597597597598 | 2.470870870870871 3.197597597597598 7.84864864864865 ]
 ~ xmatrix = [50.87087087087088 18.894894894894897 21.801801801801805 | 18.894894894894897 58.138138138138146 21.801801801801805 | 21.801801801801805 21.801801801801805 53.777777777777786 ]
 ~ cmatrix = [ 62.96320812 -29.2003284  -25.55028735 | -29.2003284   64.24072248 -29.2003284 | -25.55028735 -29.2003284   62.59820401]


! TRANSFORMERS
!new transformer.reg1 xhl=1.65 %loadloss=0.25
! ~ wdg=1 bus=sourcebus conn=wye kV=11 kVA=33300
! ~ wdg=2 bus=n6 conn=wye kV=11 kVA=33300

new transformer.t1 xhl=3.8 %loadloss=0.18
 ~ wdg=1 bus=sourcebus conn=delta kV=11 kVA=33300 tap=1
 ~ wdg=2 bus=n4 conn=wye kV=220  kVA=33300 tap=1.028

! REGULATORS
!new regcontrol.reg1 transformer=reg1 winding=2 vreg=115 band=12

! LOADS
new load.load1 phases=3 bus1=n1 conn=wye kV=220 kW=46000 kvar=13000
new load.load2 phases=3 bus1=n2 conn=wye kV=220 kW=38000 kvar=15000
new load.load3 phases=3 bus1=n3 conn=wye kV=220 kW=28000 kvar=8000
new load.load4 phases=3 bus1=n5 conn=wye kV=220 kW=26000 kvar=10000


set voltagebases=[11, 220]
calcvoltagebases     ! **** let DSS compute voltage bases
!solve mode = newton
solve

! Various reports ...
show voltages LN Nodes 
! show currents resid=yes elements  ! this shows sum of phase currents
! Show Powers kva Elements
